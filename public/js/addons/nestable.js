!function(t){var e;jQuery&&jQuery.UIkit&&(e=t(jQuery,jQuery.UIkit)),"function"==typeof define&&define.amd&&define("uikit-nestable",["uikit"],function(){return e||t(jQuery,jQuery.UIkit)})}(function(t,e){var s="ontouchstart"in window,i=t("html"),a=[],n=e.$win,l=function(){var t=document.createElement("div"),e=document.documentElement;if(!("pointerEvents"in t.style))return!1;t.style.pointerEvents="auto",t.style.pointerEvents="x",e.appendChild(t);var s=window.getComputedStyle&&"auto"===window.getComputedStyle(t,"").pointerEvents;return e.removeChild(t),!!s}(),o=s?"touchstart":"mousedown",d=s?"touchmove":"mousemove",r=s?"touchend":"mouseup",h=s?"touchcancel":"mouseup";return e.component("nestable",{defaults:{prefix:"uk",listNodeName:"ul",itemNodeName:"li",listBaseClass:"{prefix}-nestable",listClass:"{prefix}-nestable-list",listitemClass:"{prefix}-nestable-list-item",itemClass:"{prefix}-nestable-item",dragClass:"{prefix}-nestable-list-dragged",movingClass:"{prefix}-nestable-moving",handleClass:"{prefix}-nestable-handle",collapsedClass:"{prefix}-collapsed",placeClass:"{prefix}-nestable-placeholder",noDragClass:"{prefix}-nestable-nodrag",emptyClass:"{prefix}-nestable-empty",group:0,maxDepth:10,threshold:20},init:function(){var e=this;Object.keys(this.options).forEach(function(t){-1!=String(e.options[t]).indexOf("{prefix}")&&(e.options[t]=e.options[t].replace("{prefix}",e.options.prefix))}),this.tplempty='<div class="'+this.options.emptyClass+'"/>',this.find(">"+this.options.itemNodeName).addClass(this.options.listitemClass).end().find("ul:not(.ignore-list)").addClass(this.options.listClass).find(">li").addClass(this.options.listitemClass),this.element.children(this.options.itemNodeName).length||this.element.append(this.tplempty),this.element.data("nestable-id","ID"+(new Date).getTime()+"RAND"+Math.ceil(1e5*Math.random())),this.reset(),this.element.data("nestable-group",this.options.group),this.placeEl=t('<div class="'+this.options.placeClass+'"/>'),this.find(this.options.itemNodeName).each(function(){e.setParent(t(this))}),this.on("click","[data-nestable-action]",function(i){if(!e.dragEl&&(s||0===i.button)){i.preventDefault();var a=t(i.currentTarget),n=a.data("nestableAction"),l=a.closest(e.options.itemNodeName);"collapse"===n&&e.collapseItem(l),"expand"===n&&e.expandItem(l),"toggle"===n&&e.toggleItem(l)}});var i=function(i){var a=t(i.target);if(!a.hasClass(e.options.handleClass)){if(a.closest("."+e.options.noDragClass).length)return;a=a.closest("."+e.options.handleClass)}!a.length||e.dragEl||!s&&0!==i.button||s&&1!==i.touches.length||(i.preventDefault(),e.dragStart(s?i.touches[0]:i),e.trigger("nestable-start",[e]))},a=function(t){e.dragEl&&(t.preventDefault(),e.dragMove(s?t.touches[0]:t),e.trigger("nestable-move",[e]))},l=function(t){e.dragEl&&(t.preventDefault(),e.dragStop(s?t.touches[0]:t),e.trigger("nestable-stop",[e]))};s?(this.element[0].addEventListener(o,i,!1),window.addEventListener(d,a,!1),window.addEventListener(r,l,!1),window.addEventListener(h,l,!1)):(this.on(o,i),n.on(d,a),n.on(r,l))},serialize:function(){var e,s=0,i=this;return step=function(e,s){var a=[],n=e.children(i.options.itemNodeName);return n.each(function(){var e=t(this),n=t.extend({},e.data()),l=e.children(i.options.listNodeName);l.length&&(n.children=step(l,s+1)),a.push(n)}),a},e=step(i.element,s)},list:function(e){var s=[],i=this,a=0,e=t.extend({},i.options,e),n=function(i,a,l){var o=i.children(e.itemNodeName);o.each(function(i){var o=t(this),d=t.extend({parent_id:l?l:null,depth:a,order:i},o.data()),r=o.children(e.listNodeName);s.push(d),r.length&&n(r,a+1,o.data(e.idProperty||"id"))})};return n(i.element,a),s},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null;for(var t=0;t<a.length;t++)a[t].children().length||a[t].append(this.tplempty);a=[]},toggleItem:function(t){this[t.hasClass(this.options.collapsedClass)?"expandItem":"collapseItem"](t)},expandItem:function(t){t.removeClass(this.options.collapsedClass)},collapseItem:function(t){var e=t.children(this.options.listNodeName);e.length&&t.addClass(this.options.collapsedClass)},expandAll:function(){var e=this;this.find(e.options.itemNodeName).each(function(){e.expandItem(t(this))})},collapseAll:function(){var e=this;this.find(e.options.itemNodeName).each(function(){e.collapseItem(t(this))})},setParent:function(t){t.children(this.options.listNodeName).length&&t.addClass("uk-parent")},unsetParent:function(t){t.removeClass("uk-parent "+this.options.collapsedClass),t.children(this.options.listNodeName).remove()},dragStart:function(e){var s=this.mouse,a=t(e.target),n=a.closest(this.options.itemNodeName),l=n.offset();this.placeEl.css("height",n.height()),s.offsetX=e.pageX-l.left,s.offsetY=e.pageY-l.top,s.startX=s.lastX=l.left,s.startY=s.lastY=l.top,this.dragRootEl=this.element,this.dragEl=t(document.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",n.width()),this.tmpDragOnSiblings=[n[0].previousSibling,n[0].nextSibling],n.after(this.placeEl),n[0].parentNode.removeChild(n[0]),n.appendTo(this.dragEl),t(document.body).append(this.dragEl),this.dragEl.css({left:l.left,top:l.top});var o,d,r=this.dragEl.find(this.options.itemNodeName);for(o=0;o<r.length;o++)d=t(r[o]).parents(this.options.listNodeName).length,d>this.dragDepth&&(this.dragDepth=d);i.addClass(this.options.movingClass)},dragStop:function(){var t=this.dragEl.children(this.options.itemNodeName).first();t[0].parentNode.removeChild(t[0]),this.placeEl.replaceWith(t),this.dragEl.remove(),(this.tmpDragOnSiblings[0]!=t[0].previousSibling||this.tmpDragOnSiblings[0]!=t[0].previousSibling)&&(this.element.trigger("nestable-change",[t,this.hasNewRoot?"added":"moved"]),this.hasNewRoot&&this.dragRootEl.trigger("nestable-change",[t,"removed"])),this.reset(),i.removeClass(this.options.movingClass)},dragMove:function(e){var s,i,n,o,d,r=this.options,h=this.mouse;this.dragEl.css({left:e.pageX-h.offsetX,top:e.pageY-h.offsetY}),h.lastX=h.nowX,h.lastY=h.nowY,h.nowX=e.pageX,h.nowY=e.pageY,h.distX=h.nowX-h.lastX,h.distY=h.nowY-h.lastY,h.lastDirX=h.dirX,h.lastDirY=h.dirY,h.dirX=0===h.distX?0:h.distX>0?1:-1,h.dirY=0===h.distY?0:h.distY>0?1:-1;var p=Math.abs(h.distX)>Math.abs(h.distY)?1:0;if(!h.moving)return h.dirAx=p,void(h.moving=!0);h.dirAx!==p?(h.distAxX=0,h.distAxY=0):(h.distAxX+=Math.abs(h.distX),0!==h.dirX&&h.dirX!==h.lastDirX&&(h.distAxX=0),h.distAxY+=Math.abs(h.distY),0!==h.dirY&&h.dirY!==h.lastDirY&&(h.distAxY=0)),h.dirAx=p,h.dirAx&&h.distAxX>=r.threshold&&(h.distAxX=0,n=this.placeEl.prev(r.itemNodeName),h.distX>0&&n.length&&!n.hasClass(r.collapsedClass)&&(s=n.find(r.listNodeName).last(),d=this.placeEl.parents(r.listNodeName).length,d+this.dragDepth<=r.maxDepth&&(s.length?(s=n.children(r.listNodeName).last(),s.append(this.placeEl)):(s=t("<"+r.listNodeName+"/>").addClass(r.listClass),s.append(this.placeEl),n.append(s),this.setParent(n)))),h.distX<0&&(o=this.placeEl.next(r.itemNodeName),o.length||(i=this.placeEl.parent(),this.placeEl.closest(r.itemNodeName).after(this.placeEl),i.children().length||this.unsetParent(i.parent()))));var m=!1;if(l||(this.dragEl[0].style.visibility="hidden"),this.pointEl=t(document.elementFromPoint(e.pageX-document.body.scrollLeft,e.pageY-(window.pageYOffset||document.documentElement.scrollTop))),l||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(r.handleClass))this.pointEl=this.pointEl.closest(r.itemNodeName);else{var c=this.pointEl.closest("."+r.itemClass);c.length&&(this.pointEl=c.closest(r.itemNodeName))}if(this.pointEl.hasClass(r.emptyClass))m=!0;else if(this.pointEl.data("nestable")&&!this.pointEl.children().length)m=!0,this.pointEl=t(this.tplempty).appendTo(this.pointEl);else if(!this.pointEl.length||!this.pointEl.hasClass(r.listitemClass))return;var g=this.element,u=this.pointEl.closest("."+this.options.listBaseClass),f=g[0]!==this.pointEl.closest("."+this.options.listBaseClass)[0],E=u;if(!h.dirAx||f||m){if(f&&r.group!==E.data("nestable-group"))return;if(a.push(g),d=this.dragDepth-1+this.pointEl.parents(r.listNodeName).length,d>r.maxDepth)return;var v=e.pageY<this.pointEl.offset().top+this.pointEl.height()/2;i=this.placeEl.parent(),m?this.pointEl.replaceWith(this.placeEl):v?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),i.children().length||i.data("nestable")||this.unsetParent(i.parent()),this.dragRootEl.find(r.itemNodeName).length||this.dragRootEl.children().length||this.dragRootEl.append(this.tplempty),f&&(this.dragRootEl=u,this.hasNewRoot=this.element[0]!==this.dragRootEl[0])}}}),e.ready(function(s){t("[data-uk-nestable]",s).each(function(){var s=t(this);if(!s.data("nestable")){e.nestable(s,e.Utils.options(s.attr("data-uk-nestable")))}})}),e.nestable});